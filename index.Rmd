---
title: "Covid Prison Data"
---
```{r, warning=FALSE, echo=FALSE, message = FALSE, error = FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(error = FALSE)
source(here::here("R/utils.R"))
source(here::here("R/graph.R"))
source(here::here("R/map.R"))

facility_data <- readr::read_csv("https://raw.githubusercontent.com/seathebass/covid_19_state_prisons/master/data/daily/facilities_data_current.csv")
state_data <- readr::read_csv("https://raw.githubusercontent.com/seathebass/covid_19_state_prisons/master/data/daily/state_summaries_current.csv")
```


A week ago, a team of data scientists, criminologists, and law professors began a concerted effort to gather data to learn more about how incarcerated people and correctional staff are being affected by Covid-19. High-quality data are critical to provide transparency so advocates, experts, and government officials can be informed by the best information available. Here, data produced by states are integrated into one resource to facilitate access, a comparative perspective, and analysis. This is a work in progress and we appreciate feedback and suggestions.

While we have made every effort to ensure that the information scraped is accurate and updated every day, there are the following caveats. First, not all state DOC's update their information every day or even every business day. As a result, while the scraper for data pertaining to Covid-19 is run daily, the data retrieved by the scraper may not reflect daily changes. We have endeavored to mark those departments that indicate they do not update their dashboards daily.

This site offers the following data (some states have less data available than the variables below):

- Number of incarcerated people tested for Covid-19 in correctional facilities by state.
- Number of incarcerated people who tested positive for Covid-19 in correctional facilities by state.
- Number of incarcerated people who tested negative for Covid-19 in correctional facilities by state.
- Historical population data for state prisons.
- Web scrapers built to extract data from Department of Corrections dashboards.

### Figure 1. A State-and-County Level Map of the USA Showing 1) Positive COVID-19 Tests Among Incarcerated People and Correctional Staff, by State, and 2) Intensive Care Unit Beds and Percent of Population Aged 60+, by County

```{r, layout="l-page", fig.height = 6}
make_choropleth_map(state_data)
```

### Figure 2. Reported Positive COVID-19 Tests Among Incarcerated People and Correctional Staff by State, From Highest to Lowest Total Number of Reported Positive Tests

```{r, layout="l-page"}
make_mirror_graph(state_data)
```

### Figure 3. Available State-Level Data

```{r, layout="l-page"}

state_data <-
  state_data %>%
  arrange(desc(inmates_positive)) %>%
  select(state,
         scrape_date,
         inmates_positive,
         inmates_negative,
         inmates_pending,
         inmates_tested,
         inmates_deaths,
         staff_positive,
         staff_negative,
         staff_deaths) %>%
  mutate(state = as.factor(state))
names(state_data) <- gsub("_", " ", names(state_data))
names(state_data) <- crimeutils::capitalize_words(names(state_data))



DT::datatable(state_data,
              filter       = 'top',
              class        = 'cell-border stripe',
              extensions   = c('Buttons', "ColReorder"),
              options      = list(
                pageLength = 15,
                dom        = 'Bfrtip',
                buttons    = c('copy', 'csv', 'excel', 'pdf', 'print'),
                colReorder = TRUE,
                dom        = 't',
                scrollX    = TRUE)) 
```

### Figure 4. Available Facility-Level Data

```{r, layout="l-page"}

facility_data <- facility_data %>%
  filter(scrape_date %in% max(scrape_date)) %>%
  arrange(desc(inmates_positive),
          state,
          facilities) %>%
  # mutate_if(is.numeric, prettyNum, big.mark = ",") %>%
  mutate(state = as.factor(state)) %>%
  rename(facility = facilities) %>%
  select(state,
         facility,
         scrape_date,
         inmates_positive,
         inmates_negative,
         inmates_pending,
         inmates_tested,
         inmates_recovered,
         inmates_deaths)
names(facility_data) <- gsub("_", " ", names(facility_data))
names(facility_data) <- crimeutils::capitalize_words(names(facility_data))



DT::datatable(facility_data,
              filter       = 'top',
              class        = 'cell-border stripe',
              extensions   = c('Buttons', "ColReorder"),
              options      = list(
                pageLength = 15,
                dom        = 'Bfrtip',
                buttons    = c('copy', 'csv', 'excel', 'pdf', 'print'),
                colReorder = TRUE,
                dom        = 't',
                scrollX    = TRUE)) 
```